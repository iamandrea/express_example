!function(){for(var t=0,e=["ms","moz","webkit","o"],a=0;a<e.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[e[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[a]+"CancelAnimationFrame"]||window[e[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,a){var i=(new Date).getTime(),n=Math.max(0,16-(i-t)),s=window.setTimeout(function(){e(i+n)},n);return t=i+n,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}();var score={amount:0},initialState={tap:!1},gameState={active:!0},NinjaGame=function(t){function e(){g.push(new Tablet)}function a(){g=[]}function i(){b.addClass("kick"),C.x=110,setTimeout(function(){C.x=60},200),setTimeout(function(){b.removeClass("kick")},500)}function n(t,e){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)}function s(){for(var t=0;t<g.length;t++){var e=g[t];e.updatePosition(),n(e,C)&&(e.state=Tablet.KICKED),n(e,A)&&(score.amount+=1,score.amount==NinjaGame.AMOUNT_TO_WIN&&(T||(gameState.active=!0,timer.startInterval(),T=!0,setTimeout(function(){setTimeout(function(){f.addClass("slide-down")},500)},500))),score.amount<=9?$(".score").html("0"+score.amount):score.amount>=10&&$(".score").html(score.amount),$(".pink-water").addClass("fizzle"),$(".bubble-1, .bubble-2, .bubble-3").addClass("bubble-up"),setTimeout(function(){$(".pink-water").removeClass("fizzle"),$(".bubble-1, .bubble-2, .bubble-3").removeClass("bubble-up")},3e3),e.reset()),e.y>279&&e.reset()}}function o(){s(),l(),window.requestAnimationFrame(o)}function l(){m.clearRect(0,0,t.width,t.height),m.fillStyle="transparent",m.fillRect(C.x,C.y,C.width,C.height),m.fillStyle="transparent",m.fillRect(A.x,A.y,A.width,A.height);for(var e=0;e<g.length;e++){var a=g[e];m.drawImage(a.img,a.x,a.y,a.width,a.height)}}function r(){$("#container").hammer().on("tap",function(t){gameState.active&&(initialState.tap?initialState.tap&&i():(initialState.tap=!0,c.addClass("fadeOut"),i(),setTimeout(function(){c.css("display","none")},1e3)))}),$("#back-to-game").hammer().on("tap",function(t){gameState.active=!0,u.removeClass("slide-left").addClass("slide-back"),h.removeClass("slide-in").addClass("slide-right"),timer.startInterval()}),$(".replay").hammer().on("tap",function(t){score.amount=0,$(".score").html("00"),timer.resetInterval(),setTimeout(function(){gameState.active=!0,u.removeClass("slide-left").addClass("slide-back"),d.removeClass("slide-in").addClass("slide-right"),timer.startInterval()},200)})}var m=t.getContext("2d"),c=$("#tap-to-kick"),u=$("#game-frame"),h=$("#interlude"),d=$("#end-frame"),f=$(".timer"),b=$(".ninja"),T=!1,w=24,v=1,g=[],C={x:50,y:200,width:10,height:10},A={x:252,y:230,width:20,height:200};timer=new Timer,setTimeout(function(){e()},500),r(),o()};NinjaGame.AMOUNT_TO_WIN=1;var Tablet=function(){var t="../pub/img/tablet-small-2x.png";this.width=29,this.height=29,this.img=new Image,this.img.src=t,this.x=90,this.y=-50,this.speed=3,this.state=Tablet.FALLING,this.reset=function(){this.x=90,this.y=-50,this.speed=3,this.state=Tablet.FALLING},this.reset(),this.updatePosition=function(){function t(t){var e=Tablet.QUADRATIC;return e.a*t*t-e.b*t+e.c}var e=this,a=(new Date).getTime(),i=this.lastTime?(a-this.lastTime)/1e3:0,n=0,s=0;this.state==Tablet.FALLING?this.y+=Tablet.FALL_SPEED*i:this.state==Tablet.KICKED?(this.kickStartY||(this.kickStartY=this.y),this.kickStartX||(this.kickStartX=this.x),this.x+=Tablet.KICK_SPEED*i,this.y=t(this.x)):this.state==Tablet.SOME_OTHER_STATE&&(this.x+=Tablet.FALL_SPEED*i,this.y=Tablet.KICK_SPEED*i,setTimeout(function(){e.state=Tablet.FALLING},300)),this.lastTime=a}};Tablet.FALL_SPEED=150,Tablet.KICK_SPEED=200,Tablet.FALLING=1,Tablet.KICKED=2,Tablet.SOME_OTHER_STATE=3,Tablet.QUADRATIC={a:.0111,b:2.83,c:235};var Timer=function(){function t(){30==n&&o.html(n),0>=n?(gameState.active=!1,setTimeout(function(){l.removeClass("slide-back").addClass("slide-left"),r.addClass("slide-in"),i(),n--,score.amount<=9?$(".final-score").html("0"+score.amount):score.amount>=9&&$(".final-score").html(score.amount)},1e3)):10>=n?(n--,o.html("0"+n)):n>=10&&(n--,o.html(n))}function e(){clearInterval(s),n=30}function a(){o.html(n),s=setInterval(t,1e3)}function i(){clearInterval(s)}var n=30,s=null,o=$(".seconds"),l=$("#game-frame"),r=$("#end-frame");return{resetInterval:e,startInterval:a}},canvas=document.getElementById("game"),ninjaGame=new NinjaGame(canvas);